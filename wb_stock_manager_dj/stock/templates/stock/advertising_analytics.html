{% extends 'stock/base.html' %}

{% block title %}–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–µ–∫–ª–∞–º—ã - WB Stock Manager{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-chart-pie me-2 text-info"></i>{{ page_title }}</h1>
    <div>
        <a href="{% url 'advertising_dashboard' %}" class="btn btn-outline-primary me-2">
            <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥
        </a>
        <a href="{% url 'campaign_create' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>–ù–æ–≤–∞—è –∫–∞–º–ø–∞–Ω–∏—è
        </a>
    </div>
</div>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="card h-100 border-0">
            <div class="card-body text-center">
                <i class="fas fa-bullhorn fa-2x text-primary mb-3"></i>
                <h3 class="text-light">{{ total_campaigns }}</h3>
                <p class="text-muted mb-0">–í—Å–µ–≥–æ –∫–∞–º–ø–∞–Ω–∏–π</p>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="card h-100 border-0">
            <div class="card-body text-center">
                <i class="fas fa-ruble-sign fa-2x text-warning mb-3"></i>
                <h3 class="text-light">{{ total_spent|floatformat:2 }} ‚ÇΩ</h3>
                <p class="text-muted mb-0">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</p>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="card h-100 border-0">
            <div class="card-body text-center">
                <i class="fas fa-shopping-cart fa-2x text-success mb-3"></i>
                <h3 class="text-light">{{ total_orders }}</h3>
                <p class="text-muted mb-0">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</p>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-3">
        <div class="card h-100 border-0">
            <div class="card-body text-center">
                <i class="fas fa-mouse-pointer fa-2x text-info mb-3"></i>
                <h3 class="text-light">{{ total_clicks }}</h3>
                <p class="text-muted mb-0">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- –°–∞–º—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ -->
    <div class="col-lg-6 mb-4">
        <div class="card border-0 h-100">
            <div class="card-header bg-dark border-0">
                <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>–°–∞–º—ã–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ (–ø–æ CPO)</h5>
            </div>
            <div class="card-body">
                {% if effective_campaigns %}
                    {% for item in effective_campaigns %}
                    <div class="d-flex justify-content-between align-items-center py-2 border-bottom border-secondary">
                        <div>
                            <h6 class="mb-1">{{ item.campaign.name }}</h6>
                            <small class="text-muted">
                                {{ item.campaign.get_campaign_type_display }} ‚Ä¢ 
                                {{ item.campaign.total_orders }} –∑–∞–∫–∞–∑–æ–≤
                            </small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold text-success">{{ item.cpo|floatformat:2 }} ‚ÇΩ CPO</div>
                            <small class="text-muted">ROI: {{ item.roi|floatformat:1 }}%</small>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º -->
    <div class="col-lg-6 mb-4">
        <div class="card border-0 h-100">
            <div class="card-header bg-dark border-0">
                <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫–∞–º–ø–∞–Ω–∏–π</h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="mb-4">
                            <i class="fas fa-search fa-2x text-primary mb-2"></i>
                            <h4>{{ search_campaigns_count }}</h4>
                            <p class="text-muted mb-1">–ü–æ–∏—Å–∫–æ–≤—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</p>
                            <small class="text-success">{{ search_campaigns_orders }} –∑–∞–∫–∞–∑–æ–≤</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="mb-4">
                            <i class="fas fa-gavel fa-2x text-warning mb-2"></i>
                            <h4>{{ auction_campaigns_count }}</h4>
                            <p class="text-muted mb-1">–ê—É–∫—Ü–∏–æ–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</p>
                            <small class="text-success">{{ auction_campaigns_orders }} –∑–∞–∫–∞–∑–æ–≤</small>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="campaignTypeChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
<div class="card border-0">
    <div class="card-header bg-dark border-0">
        <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="card bg-dark border-primary">
                    <div class="card-body">
                        <h6><i class="fas fa-bullseye text-primary me-2"></i>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–∞–≤–æ–∫</h6>
                        <p class="small text-muted mb-0">–°–Ω–∏–∂–∞–π—Ç–µ —Å—Ç–∞–≤–∫–∏ –¥–ª—è –∫–∞–º–ø–∞–Ω–∏–π —Å CPO –≤—ã—à–µ 1000 —Ä—É–±–ª–µ–π</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-dark border-success">
                    <div class="card-body">
                        <h6><i class="fas fa-chart-line text-success me-2"></i>–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ</h6>
                        <p class="small text-muted mb-0">–£–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –±—é–¥–∂–µ—Ç—ã –¥–ª—è –∫–∞–º–ø–∞–Ω–∏–π —Å CPO –Ω–∏–∂–µ 500 —Ä—É–±–ª–µ–π</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card bg-dark border-warning">
                    <div class="card-body">
                        <h6><i class="fas fa-balance-scale text-warning me-2"></i>–ë–∞–ª–∞–Ω—Å</h6>
                        <p class="small text-muted mb-0">–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –ø–æ–∏—Å–∫–æ–≤—ã–º–∏ –∫–∞–º–ø–∞–Ω–∏—è–º–∏ –∏ –∞—É–∫—Ü–∏–æ–Ω–∞–º–∏</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –∫–∞–º–ø–∞–Ω–∏–π
const typeCtx = document.getElementById('campaignTypeChart').getContext('2d');
new Chart(typeCtx, {
    type: 'doughnut',
    data: {
        labels: ['üîç –ü–æ–∏—Å–∫–æ–≤—ã–µ', '‚ö° –ê—É–∫—Ü–∏–æ–Ω—ã'],
        datasets: [{
            data: [{{ search_campaigns_count }}, {{ auction_campaigns_count }}],
            backgroundColor: ['#ff6b35', '#ffa94d'],
            borderColor: ['#e55a2b', '#ff922b'],
            borderWidth: 2
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    color: '#f8f9fa',
                    padding: 20
                }
            }
        }
    }
});
</script>
{% endblock %}