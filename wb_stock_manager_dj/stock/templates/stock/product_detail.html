{% extends 'stock/base.html' %}

{% block title %}{{ page_title }} - WB Stock Manager{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üì¶ {{ product.name }}</h1>
    <div>
        <a href="{% url 'movement_add' product.id %}" class="btn btn-primary me-2">
            <i class="fas fa-exchange-alt me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ
        </a>
        <a href="{% url 'product_edit' product.id %}" class="btn btn-outline-warning me-2">
            <i class="fas fa-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </a>
        <a href="{% url 'product_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥
        </a>
    </div>
</div>

<div class="row">
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
    <div class="col-md-4 mb-4">
        <div class="card border-0">
            <div class="card-body">
                <h5 class="card-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ</h5>
                
                {% if product.image %}
                <div class="text-center mb-3">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                         class="rounded" style="max-width: 200px; max-height: 200px; object-fit: cover;">
                </div>
                {% endif %}
                
                <div class="mb-2">
                    <strong>–ê—Ä—Ç–∏–∫—É–ª:</strong> 
                    <code>{{ product.article }}</code>
                </div>
                <div class="mb-2">
                    <strong>–î–∞—Ç–∞ –∑–∞–∫—É–ø–∫–∏:</strong> 
                    {{ product.purchase_date }}
                </div>
                <div class="mb-2">
                    <strong>–î–Ω–µ–π –Ω–∞ —Å–∫–ª–∞–¥–µ:</strong> 
                    <span class="badge bg-info">{{ product.days_in_stock }} –¥–Ω.</span>
                </div>
                <div class="mb-2">
                    <strong>–ù–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø–∞—Å:</strong> 
                    {{ product.initial_quantity }}
                </div>
                <div class="mb-2">
                    <strong>–í—Å–µ–≥–æ –ø—Ä–∏—Ö–æ–¥:</strong> 
                    <span class="text-success">+{{ product.total_incoming }}</span>
                </div>
                <div class="mb-2">
                    <strong>–í—Å–µ–≥–æ —Ä–∞—Å—Ö–æ–¥:</strong> 
                    <span class="text-danger">-{{ product.total_outgoing }}</span>
                </div>
                <div class="mb-0">
                    <strong>–¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫:</strong> 
                    <span class="{% if product.current_stock < 10 %}text-danger fw-bold{% else %}text-success fw-bold{% endif %}">
                        {{ product.current_stock }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò—Å—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏–π -->
    <div class="col-md-8">
        <div class="card border-0">
            <div class="card-body">
                <h5 class="card-title">–ò—Å—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏–π</h5>
                
                {% if movements %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</th>
                                <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</th>
                                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for movement in movements %}
                            <tr>
                                <td>{{ movement.date }}</td>
                                <td>
                                    {% if movement.movement_type == 'in' %}
                                        <span class="badge bg-success">üü¢ –ü—Ä–∏—Ö–æ–¥</span>
                                    {% else %}
                                        <span class="badge bg-danger">üî¥ –†–∞—Å—Ö–æ–¥</span>
                                    {% endif %}
                                </td>
                                <td>{{ movement.quantity }}</td>
                                <td>{{ movement.notes|default:"-" }}</td>
                                <td>{{ movement.created_at|date:"d.m.Y H:i" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-history fa-2x text-muted mb-3"></i>
                    <p class="text-muted">–î–≤–∏–∂–µ–Ω–∏–π –ø–æ —Ç–æ–≤–∞—Ä—É –ø–æ–∫–∞ –Ω–µ—Ç</p>
                    <a href="{% url 'movement_add' product.id %}" class="btn btn-primary">
                        <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}