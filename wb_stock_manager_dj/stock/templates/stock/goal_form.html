{% extends 'stock/base.html' %}

{% block title %}{{ page_title }} - WB Stock Manager{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üéØ {{ page_title }}</h1>
            <a href="{% url 'campaign_goals' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>–ù–∞–∑–∞–¥ –∫ —Ü–µ–ª—è–º
            </a>
        </div>

        <div class="card border-0">
            <div class="card-header bg-dark border-0">
                <h5 class="mb-0">
                    <i class="fas fa-{% if goal %}edit{% else %}plus{% endif %} me-2"></i>
                    {{ page_title }}
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.title.id_for_label }}" class="form-label">
                                <strong>–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ *</strong>
                            </label>
                            {{ form.title }}
                            {% if form.title.errors %}
                            <div class="text-danger small">{{ form.title.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.goal_type.id_for_label }}" class="form-label">
                                <strong>–¢–∏–ø —Ü–µ–ª–∏ *</strong>
                            </label>
                            {{ form.goal_type }}
                            {% if form.goal_type.errors %}
                            <div class="text-danger small">{{ form.goal_type.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.description.id_for_label }}" class="form-label">
                            <strong>–û–ø–∏—Å–∞–Ω–∏–µ —Ü–µ–ª–∏</strong>
                        </label>
                        {{ form.description }}
                        <div class="form-text">–û–ø–∏—à–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ—Å—Ç–∏—á—å —Å –ø–æ–º–æ—â—å—é —ç—Ç–æ–π —Ü–µ–ª–∏</div>
                        {% if form.description.errors %}
                        <div class="text-danger small">{{ form.description.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.target_value.id_for_label }}" class="form-label">
                                <strong>–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</strong>
                            </label>
                            {{ form.target_value }}
                            <div class="form-text">–ù–∞–ø—Ä–∏–º–µ—Ä: 100000 (—Ä—É–±–ª–µ–π), 500 (–∑–∞–∫–∞–∑–æ–≤), 15 (%)</div>
                            {% if form.target_value.errors %}
                            <div class="text-danger small">{{ form.target_value.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.current_value.id_for_label }}" class="form-label">
                                <strong>–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</strong>
                            </label>
                            {{ form.current_value }}
                            <div class="form-text">–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ —Ü–µ–ª–∏</div>
                            {% if form.current_value.errors %}
                            <div class="text-danger small">{{ form.current_value.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.deadline.id_for_label }}" class="form-label">
                                <strong>–î–µ–¥–ª–∞–π–Ω</strong>
                            </label>
                            {{ form.deadline }}
                            {% if form.deadline.errors %}
                            <div class="text-danger small">{{ form.deadline.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">
                                <strong>–°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏</strong>
                            </label>
                            <div class="border rounded p-3" style="background: var(--light-black); border-color: var(--accent-gray) !important; max-height: 200px; overflow-y: auto;">
                                {% for checkbox in form.campaigns %}
                                <div class="form-check">
                                    {{ checkbox.tag }}
                                    <label class="form-check-label text-light" for="{{ checkbox.id_for_label }}">
                                        {{ checkbox.choice_label }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–ø–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∞–Ω—ã —Å —ç—Ç–æ–π —Ü–µ–ª—å—é</div>
                            {% if form.campaigns.errors %}
                            <div class="text-danger small">{{ form.campaigns.errors }}</div>
                            {% endif %}
                        </div>

                    {% if goal %}
                    <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ü–µ–ª–∏ -->
                    <div class="card bg-dark border-info mb-4">
                        <div class="card-body">
                            <h6 class="card-title"><i class="fas fa-chart-line me-2"></i>–¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h6>
                            <div class="progress mb-2" style="height: 25px;">
                                <div class="progress-bar {% if goal.progress_percentage < 50 %}bg-warning{% elif goal.progress_percentage < 80 %}bg-info{% else %}bg-success{% endif %}" 
                                     style="width: {{ goal.progress_percentage }}%">
                                    {{ goal.progress_percentage }}%
                                </div>
                            </div>
                            <div class="row text-center">
                                <div class="col-6">
                                    <small class="text-muted">–¢–µ–∫—É—â–µ–µ:</small>
                                    <div class="fw-bold text-primary">{{ goal.current_value }}</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">–¶–µ–ª–µ–≤–æ–µ:</small>
                                    <div class="fw-bold text-success">{{ goal.target_value|default:"–ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ" }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'campaign_goals' %}" class="btn btn-secondary me-md-2">
                            <i class="fas fa-times me-2"></i>–û—Ç–º–µ–Ω–∞
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>{{ submit_text }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Ü–µ–ª–µ–π -->
        <div class="card border-0 mt-4">
            <div class="card-header bg-dark border-0">
                <h6 class="mb-0"><i class="fas fa-lightbulb me-2"></i>–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–∏–ø–∞–º —Ü–µ–ª–µ–π</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <strong>üéØ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂</strong>
                        <p class="small text-muted mb-0">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∏–ª–∏ —Å—É–º–º–∞ –≤—ã—Ä—É—á–∫–∏</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>üöÄ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞</strong>
                        <p class="small text-muted mb-0">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –∏–ª–∏ –ø–æ–∫–∞–∑–æ–≤</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>üìà –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏</strong>
                        <p class="small text-muted mb-0">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –ø—Ä–æ—Ü–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5%)</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>üèÜ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–∞</strong>
                        <p class="small text-muted mb-0">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: –æ—Ö–≤–∞—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏ –∏–ª–∏ —É–∑–Ω–∞–≤–∞–µ–º–æ—Å—Ç—å</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>üí∞ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏</strong>
                        <p class="small text-muted mb-0">–¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: —Å—É–º–º–∞ —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏ –≤ —Ä—É–±–ª—è—Ö</p>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>üìù –î—Ä—É–≥–∞—è —Ü–µ–ª—å</strong>
                        <p class="small text-muted mb-0">–õ—é–±–∞—è –¥—Ä—É–≥–∞—è –º–µ—Ç—Ä–∏–∫–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control {
    background: var(--light-black);
    border: 1px solid var(--accent-gray);
    color: var(--text-light);
}

.form-control:focus {
    background: var(--light-black);
    border-color: var(--primary-orange);
    color: var(--text-light);
    box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
}

.form-label {
    color: var(--text-light);
}

.form-text {
    color: var(--text-muted) !important;
}

.progress {
    background-color: var(--accent-gray);
    border-radius: 12px;
}

.progress-bar {
    border-radius: 12px;
    transition: width 0.6s ease;
}
</style>
{% endblock %}