{% extends 'stock/base.html' %}

{% block title %}–ú–æ–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ - WB Stock Manager{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-bullseye me-2 text-warning"></i>{{ page_title }}</h1>
    <div>
        <a href="{% url 'campaign_create' %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
        </a>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card border-0 mb-4">
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="btn-group w-100">
                    <a href="?{% if status_filter %}status={{ status_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if not campaign_type_filter or campaign_type_filter == 'all' %}filter-active{% endif %}">
                        –í—Å–µ —Ç–∏–ø—ã
                    </a>
                    <a href="?type=search{% if status_filter %}&status={{ status_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if campaign_type_filter == 'search' %}filter-active{% endif %}">
                        üîç –ü–æ–∏—Å–∫–æ–≤—ã–µ
                    </a>
                    <a href="?type=auction{% if status_filter %}&status={{ status_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if campaign_type_filter == 'auction' %}filter-active{% endif %}">
                        ‚ö° –ê—É–∫—Ü–∏–æ–Ω—ã
                    </a>
                </div>
            </div>
            <div class="col-md-6">
                <div class="btn-group w-100">
                    <a href="?{% if campaign_type_filter %}type={{ campaign_type_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if not status_filter or status_filter == 'all' %}filter-active{% endif %}">
                        –í—Å–µ —Å—Ç–∞—Ç—É—Å—ã
                    </a>
                    <a href="?status=active{% if campaign_type_filter %}&type={{ campaign_type_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if status_filter == 'active' %}filter-active{% endif %}">
                        üü¢ –ê–∫—Ç–∏–≤–Ω—ã–µ
                    </a>
                    <a href="?status=paused{% if campaign_type_filter %}&type={{ campaign_type_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if status_filter == 'paused' %}filter-active{% endif %}">
                        üü° –ù–∞ –ø–∞—É–∑–µ
                    </a>
                    <a href="?status=completed{% if campaign_type_filter %}&type={{ campaign_type_filter }}{% endif %}" 
                       class="btn btn-outline-primary {% if status_filter == 'completed' %}filter-active{% endif %}">
                        üî¥ –ó–∞–≤–µ—Ä—à–µ–Ω—ã
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –∫–∞–º–ø–∞–Ω–∏–π -->
<div class="card border-0">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–¢–∏–ø</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–°—Ç–∞—Ç—É—Å</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–¢–æ–≤–∞—Ä—ã</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–ü–æ–∫–∞–∑—ã</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–ö–ª–∏–∫–∏</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–ö–æ—Ä–∑–∏–Ω—ã</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–ó–∞–∫–∞–∑—ã</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–ó–∞—Ç—Ä–∞—Ç—ã</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">CPO</th>
                        <th style="color: var(--text-light) !important; font-weight: 700;">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for campaign in campaigns %}
                    <tr>
                        <td>
                            <a href="{% url 'campaign_detail' campaign.id %}" class="text-decoration-none">
                                <span class="fw-semibold text-primary hover-underline" style="color: var(--primary-orange) !important;">
                                    {{ campaign.name }}
                                </span>
                            </a>
                        </td>
                        <td>{{ campaign.get_campaign_type_display }}</td>
                        <td>
                            <span class="badge {% if campaign.status == 'active' %}bg-success{% elif campaign.status == 'paused' %}bg-warning{% else %}bg-danger{% endif %}">
                                {{ campaign.get_status_display }}
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-info">{{ campaign.products.count }}</span>
                        </td>
                        <td>{{ campaign.total_views }}</td>
                        <td>{{ campaign.total_clicks }}</td>
                        <td>{{ campaign.total_cart_adds }}</td>
                        <td class="fw-bold text-success">{{ campaign.total_orders }}</td>
                        <td class="fw-bold text-warning">{{ campaign.total_spent|floatformat:2 }} ‚ÇΩ</td>
                        <td>
                            {% if campaign.cpo > 0 %}
                                <span class="badge {% if campaign.cpo < 500 %}bg-success{% elif campaign.cpo < 1000 %}bg-warning{% else %}bg-danger{% endif %}">
                                    {{ campaign.cpo|floatformat:2 }} ‚ÇΩ
                                </span>
                            {% else %}
                                <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group">
                                <a href="{% url 'campaign_detail' campaign.id %}" class="btn btn-sm btn-outline-primary" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'campaign_edit' campaign.id %}" class="btn btn-sm btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="{% url 'campaign_delete' campaign.id %}" class="btn btn-sm btn-outline-danger" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="11" class="text-center py-5">
                            <div class="text-muted">
                                <i class="fas fa-bullhorn fa-3x mb-3"></i>
                                <h4>–ö–∞–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                                <p class="mb-3">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Ä–µ–∫–ª–∞–º–Ω—É—é –∫–∞–º–ø–∞–Ω–∏—é</p>
                                <a href="{% url 'campaign_create' %}" class="btn btn-primary">
                                    <i class="fas fa-plus me-2"></i>–°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π */
.hover-underline:hover {
    text-decoration: underline !important;
}

/* –£–ª—É—á—à–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü—ã */
.table th {
    background: linear-gradient(135deg, var(--primary-orange), var(--dark-orange)) !important;
    color: var(--text-light) !important;
    font-weight: 700 !important;
    border: none !important;
    padding: 15px 12px !important;
    font-size: 0.9rem !important;
}

/* –£–ª—É—á—à–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã */
.table td {
    background: var(--light-black) !important;
    color: var(--text-light) !important;
    border-color: var(--accent-gray) !important;
    padding: 12px !important;
    vertical-align: middle !important;
}

/* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É */
.table-hover tbody tr:hover {
    background: rgba(255, 107, 53, 0.1) !important;
    transform: scale(1.01);
    transition: all 0.2s ease;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö —è—á–µ–µ–∫ */
.table tbody tr {
    cursor: pointer;
}

.table tbody tr td:first-child {
    border-left: 3px solid transparent;
    transition: border-left 0.2s ease;
}

.table tbody tr:hover td:first-child {
    border-left: 3px solid var(--primary-orange);
}
</style>

<script>
// –î–µ–ª–∞–µ–º –≤—Å—é —Å—Ç—Ä–æ–∫—É –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π (–∫—Ä–æ–º–µ –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π)
document.addEventListener('DOMContentLoaded', function() {
    const tableRows = document.querySelectorAll('.table tbody tr');
    
    tableRows.forEach(row => {
        // –ò—Å–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–Ω–µ—Ç –∫–∞–º–ø–∞–Ω–∏–π"
        if (row.cells.length > 1) {
            row.addEventListener('click', function(e) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º –¥–µ–π—Å—Ç–≤–∏–π
                if (!e.target.closest('.btn-group') && !e.target.closest('a[title]')) {
                    const link = this.querySelector('a[href*="campaign_detail"]');
                    if (link) {
                        window.location.href = link.href;
                    }
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –≤—Å—é —Å—Ç—Ä–æ–∫—É
            row.style.cursor = 'pointer';
        }
    });
});
</script>

{% endblock %}